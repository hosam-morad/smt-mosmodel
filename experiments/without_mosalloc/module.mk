MODULE_NAME := experiments/without_mosalloc

MEMORY_FOOTPRINT_EXPERIMENT := $(MODULE_NAME)/repeat1
MAX_RES_MEMORY_FILE := $(MEMORY_FOOTPRINT_EXPERIMENT)/max_mem.txt
TIME_OUTPUT_FILENAME := time.out
TIME_OUTPUT := $(MEMORY_FOOTPRINT_EXPERIMENT)/$(TIME_OUTPUT_FILENAME)

$(MODULE_NAME): $(MAX_RES_MEMORY_FILE)

$(MAX_RES_MEMORY_FILE): $(TIME_OUTPUT)
	grep "Maximum resident" $(TIME_OUTPUT) | cut -d ':' -f 2 | tr -d ' ' > $@

$(TIME_OUTPUT):
	$(RUN_BENCHMARK) --submit_command "/usr/bin/time -v -o $(TIME_OUTPUT_FILENAME)" \
		$(BENCHMARK_PATH) $(MEMORY_FOOTPRINT_EXPERIMENT)

$(MODULE_NAME)/clean:
	rm -rf $(MEMORY_FOOTPRINT_EXPERIMENT)

